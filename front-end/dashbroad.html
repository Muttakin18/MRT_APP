<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>MRT Dashboard</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdn.jsdelivr.net/npm/qrcodejs@1.0.0/qrcode.min.js"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
  <style>
    @keyframes scrollText {
      0% { transform: translateX(100%); }
      100% { transform: translateX(-100%); }
    }
    .animate-scroll {
      display: inline-block;
      animation: scrollText 15s linear infinite;
    }
  </style>
</head>
<body class="bg-white/80 min-h-screen font-sans relative text-lg bg-[url('/front-end/image/signup.jpg')] bg-cover bg-center bg-no-repeat">

  <!-- üîî Notification Bell -->
  <div class="absolute top-4 right-6 z-50">
    <button onclick="toggleNotification()" class="text-3xl text-[#006a4e] hover:text-[#f42a41] transition">
      <i class="fas fa-bell"></i>
    </button>
  </div>

  <!-- üîî Notification Drawer -->
  <div id="notificationDrawer" class="fixed top-0 right-0 w-96 h-screen bg-white shadow-lg z-40 p-6 overflow-y-auto transform translate-x-full transition-transform duration-300">
    <h2 class="text-3xl font-bold mb-6 text-[#006a4e]">üîî Notifications</h2>
    <div id="notificationList"></div>
  </div>

  <!-- ‚ò∞ Sidebar Toggle -->
  <div class="absolute left-4 top-4 z-50">
    <button onclick="toggleMenu()" class="text-3xl text-[#006a4e] hover:text-[#f42a41] transition">&#9776;</button>
  </div>

  <!-- üëã Greeting Card -->
  <div class="flex justify-center mt-20 px-4">
    <div class="bg-gradient-to-br from-[#006a4e] to-[#f42a41] text-white w-full max-w-5xl rounded-xl shadow-2xl px-8 py-20 flex flex-col justify-between items-center space-y-10">
      <div class="text-center">
        <h1>Good Morning, <span class="username uppercase">Loading...</span>!</h1>
        <p class="text-lg md:text-xl">Balance: <span class="text-yellow-200 font-semibold">BDT 0.00</span></p>
      </div>
      <div class="flex gap-6">
        <button id="rechargeBtn" class="bg-[#006a4e] hover:bg-[#0c8d60] text-white font-semibold px-6 py-3 rounded-xl shadow-lg text-xl transition">
  Recharge
</button>

      </div>
    </div>
  </div>

  <!-- üìÖ Recharge History Modal -->
  <div id="rechargeHistoryModal" class="hidden fixed inset-0 bg-white z-50 p-10 overflow-y-auto">
    <div class="flex justify-between items-center mb-8">
      <h2 class="text-4xl font-extrabold text-[#006a4e]">üìÖ Previous Recharges</h2>
      <button onclick="closeRechargeHistory()" class="text-3xl text-red-600 hover:text-red-800">&times;</button>
    </div>
    <div id="rechargeGrid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6"></div>
  </div>

  <!-- üìã Sidebar -->
  <div id="menu" class="fixed top-0 left-0 w-64 h-full bg-white shadow-lg transform -translate-x-full transition-transform duration-300 z-40">
    <div class="p-4 border-b font-bold text-[#006a4e] text-lg flex justify-between items-center">
      <span>Menu</span>
      <button onclick="toggleMenu()" class="text-4xl font-bold text-[#006a4e] hover:text-[#f42a41] transition">&times;</button>
    </div>
    <ul class="p-4 space-y-6 text-xl font-semibold">
      <li><a href="/front-end/ticket.html" class="hover:text-[#006a4e] transition">üéüÔ∏è Purchase Ticket</a></li>
      <li><a href="/front-end/checkfare.html" class="hover:text-[#006a4e] transition">üí∞ Check Fare</a></li>
      <li><a href="/front-end/history.html" class="hover:text-[#006a4e] transition">üìú History</a></li>
      <li><a href="/front-end/schedule.html" class="hover:text-[#006a4e] transition">üïì Schedule</a></li>
      <li><a href="/front-end/profile.html" class="hover:text-[#006a4e] transition">üë§ Profile</a></li>
      <li><a href="login.html" class="text-red-600 hover:text-red-800 transition">üö™ Logout</a></li>
    </ul>
  </div>

  <script>
    function toggleMenu() {
      const menu = document.getElementById('menu');
      menu.classList.toggle('-translate-x-full');
    }

    function toggleNotification() {
      const drawer = document.getElementById('notificationDrawer');
      drawer.classList.toggle('translate-x-full');
    }

    function showRechargeHistory() {
      document.getElementById('rechargeHistoryModal').classList.remove('hidden');
    }

    function closeRechargeHistory() {
      document.getElementById('rechargeHistoryModal').classList.add('hidden');
    }

    async function fetchUserData() {
      const token = localStorage.getItem('token');
      if (!token) {
        alert('Please login first.');
        window.location.href = 'login.html';
        return;
      }
      try {
        const res = await fetch('http://localhost:3000/api/auth/me', {
          headers: { 'Authorization': 'Bearer ' + token }
        });
        if (!res.ok) throw new Error('Failed to fetch user data');
        const user = await res.json();
        document.querySelector('span.username').textContent = user.username || 'User';
        document.querySelector('.text-yellow-200').textContent = 'BDT ' + (user.balance || 0).toFixed(2);
      } catch (err) {
        console.error(err);
        alert('Error loading user data. Please login again.');
        localStorage.removeItem('token');
        window.location.href = 'login.html';
      }
    }

    async function fetchNotifications() {
      const token = localStorage.getItem('token');
      if (!token) return;
      try {
        const res = await fetch('http://localhost:3000/api/notifications', {
          headers: { 'Authorization': 'Bearer ' + token }
        });
        if (!res.ok) throw new Error('Failed to fetch notifications');
        const notifications = await res.json();
        displayNotifications(notifications);
      } catch (err) {
        console.error('Error fetching notifications:', err);
      }
    }

    function displayNotifications(notifications) {
      const notificationList = document.getElementById('notificationList');
      notificationList.innerHTML = '';

      if (notifications.length === 0) {
        notificationList.innerHTML = '<p class="text-gray-500 text-center">No new notifications.</p>';
        return;
      }

      notifications.sort(() => Math.random() - 0.5);
      notifications.forEach(notif => {
        const notifCard = document.createElement('div');
        notifCard.className = 'notif-card p-4 bg-green-100 rounded-xl shadow hover:bg-green-200 transition cursor-pointer mb-4 relative overflow-hidden';
        notifCard.dataset.id = notif._id;
        notifCard.innerHTML = `
          <button onclick="deleteNotification('${notif._id}', this)" class="absolute top-2 right-2 text-red-600 hover:text-red-800 text-xl">
            <i class="fas fa-trash-alt"></i>
          </button>
          <h4 class="font-bold text-xl text-green-800">${notif.title}</h4>
          <p class="text-gray-700 text-xl font-semibold">${notif.message}</p>
        `;
        notificationList.appendChild(notifCard);
      });
    }

    async function deleteNotification(notificationId, btnElement) {
      const token = localStorage.getItem('token');
      if (!token) return;

      if (!confirm('Are you sure you want to delete this notification?')) return;

      try {
        const res = await fetch(`http://localhost:3000/api/notifications/${notificationId}`, {
          method: 'DELETE',
          headers: { 'Authorization': 'Bearer ' + token }
        });
        if (!res.ok) throw new Error('Failed to delete notification');

        btnElement.closest('.notif-card').remove();
        alert('‚úÖ Notification deleted!');
      } catch (err) {
        console.error('Error deleting notification:', err);
        alert('‚ùå Failed to delete notification: ' + err.message);
      }
    }document.getElementById('rechargeBtn').addEventListener('click', (e) => {
  e.preventDefault();  // prevents navigation if you want to stay here
  alert('Recharge button clicked ‚ö°');
  // You can add your recharge logic here
});


    window.onload = () => {
      fetchUserData();
      fetchNotifications();
    };
  </script>
</body>
</html>
